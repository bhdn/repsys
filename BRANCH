The detached binaries repository
================================

A brief description:

All the binaries from packages sources (ie. all the binary files inside
SOURCES/) will be placed in another subversion repository. This repository
is called "binaries repository" or "tarballs repository". It will contain
mostly the same directory structure of the main repository, but instead of
having SOURCES and SPECS, it will only have a SOURCES-bin directory.

Why a new repository without the tarballs
==========================================

- the current svn repository is too large, hard to manage
- there is no easy way to strip undesired tarballs without recreating the
  whole repository


Drawbacks of this layout
=========================

- everything that changes the single-repository usage increases the chance
  of failure and make things more complicated.


Description of the operations on repsys
========================================

repsys co 2008.1/mutt
---------------------

- repsys checkouts
  http://svn.mandriva.com/svn/packages/updates/2008.1/mutt/current to the
  mutt directory

- repsys checkouts
  http://svn.mandriva.com/svn/binrepo/updates/2008.1/mutt/current/SOURCES-bin
  into mutt/SOURCES-bin

- creates symlinks for all files found in SOURCES-bin/ into ../SOURCES/

  (rpm doesn't handle symlinks, this allows us to have explicit links and
   proper src.rpm generates by rpmbuild)

upgrading to a newer version of the package
-------------------------------------------

  $ cd bla/SOURCES/
  $ wget http://prdownloads.sourceforge.net/bla/bla-1.6.tar.bz2
  $ repsys add bla-1.6.0.tar.bz2

- repsys notices this is a tarball (checking filename and/or file size)

- repsys will move the file to SOURCES-bin/, create the symlink, and svn-add
  it to the working copy

- the spec file is updated with new version and release numbers

  $ cd ../ # package top dir
  $ repsys ci

- repsys will commit the new tarball on SOURCES-bin/ and then on the rest
  of the working copy


updating an old working copy without binrepo.lst
------------------------------------------------

  $ repsys up

- it will update the working copy

- it will notice binrepo.lst is not in the working copy

- looks for those files referred int the spec but also not present in the
  working copy

TODO finish


Description
===========

Support separate repositories for tarballs.

TODO
=====

- Rename SOURCES/sources to SOURCES/binrepo.lst; less ambiguity when
  discussing about package structure. (DONE)

- Support no-tarballs-and-no-binrepo.lst repositories: (MUST)

  + Support checkout and getsrpm without binrepo.lst (DONE)

    * binrepo.enabled() returns true if binrepo is enabled in conf (DONE)

    * download from binrepo those files that are referred in the spec but
      are not found in the svn checkout/export (DONE)

    * adapt upload (MUST)

    * change "up" to look only for the missing files when binrepo.lst is
      not available (MUST)

    * adapt markrelease (MUST)
    
  + Enforce binrepo.lst on markrelease;

  + Enforce binrepo.lst on submit.

- Support updates/:

  + Merge the work from branch V1_6_X.feature.support-update-urls  (TODO)

